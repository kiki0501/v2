# Docker Compose 配置文件 - 使用 GHCR 预构建镜像
# 使用方法: docker-compose -f docker-compose.ghcr.yml up -d

version: '3.8'

services:
  vertex-ai-proxy:
    # 使用 GHCR 预构建镜像
    # 请将 YOUR_USERNAME/YOUR_REPO 替换为实际的 GitHub 用户名和仓库名
    image: ghcr.io/YOUR_USERNAME/YOUR_REPO/vertex-ai-proxy-v2:latest
    
    container_name: vertex-ai-proxy-v2
    
    ports:
      - "7860:7860"    # API 端口
      - "28881:28881"  # WebSocket 端口
    
    volumes:
      # 挂载凭证文件以持久化
      - ./credentials.json:/app/credentials.json
      - ./stats.json:/app/stats.json
      - ./auth_bundle.json:/app/auth_bundle.json
    
    environment:
      - NOGUI=1
      - PYTHONUNBUFFERED=1
      - API_KEY=your-secret-api-key-here  # 请修改为您自己的密钥
    
    # 资源限制（可选，根据实际需求调整）
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
    
    restart: unless-stopped
    
    networks:
      - vertex-proxy-network

networks:
  vertex-proxy-network:
    driver: bridge